<DataTemplate
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:colors="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Shell.15.0"
    xmlns:styles="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.15.0"
    xmlns:vs="http://schemas.microsoft.com/visualstudio/extensibility/2022/xaml"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid>
        <Grid.Resources>
            <Style BasedOn="{StaticResource {x:Static styles:VsResourceKeys.ThemedDialogLabelStyleKey}}" TargetType="Label" />
            <Style BasedOn="{StaticResource {x:Static styles:VsResourceKeys.TextBoxStyleKey}}" TargetType="TextBox" />
            <Style BasedOn="{StaticResource {x:Static styles:VsResourceKeys.ButtonStyleKey}}" TargetType="Button" />
            <Style TargetType="TextBlock">
                <Setter Property="Foreground" Value="{DynamicResource {x:Static styles:VsBrushes.WindowTextKey}}" />
            </Style>
        </Grid.Resources>
        <StackPanel Orientation="Vertical" Visibility="{Binding InactiveWatcherVisibility}">
            <StackPanel Orientation="Horizontal">
                <Image
                    Height="32"
                    Source="Images/eye-tsp-53-32.png"
                    Width="53" />

                <Label FontSize="14" Margin="10,0,0,0">Watch for changes</Label>
            </StackPanel>

            <DockPanel Margin="0,15,0,0">
                <TextBlock TextWrapping="WrapWithOverflow">
                    Starting the watcher will run all calculations
                    in the watched project until it is stopped.
                    It will provide instant feedback on inputs,
                    outputs and formulae.
                </TextBlock>
            </DockPanel>

            <StackPanel
                HorizontalAlignment="Center"
                Margin="0,40,0,0"
                Orientation="Horizontal"
                Visibility="{Binding WaitingForTabVisibility}">
                <Image
                    Height="24"
                    Source="Images/wait-32.png"
                    Width="24" />

                <Label>Waiting for a tab to open...</Label>
            </StackPanel>

            <StackPanel
                HorizontalAlignment="Center"
                Margin="0,40,0,0"
                Orientation="Vertical"
                Visibility="{Binding ActiveProjectPath}">
                <Button
                    BorderThickness="0"
                    Margin="10,0,0,0"
                    Padding="10">
                    <Image
                        Height="24"
                        Source="Images/play-24.png"
                        Width="24" />
                </Button>

                <TextBlock
                    HorizontalAlignment="Center"
                    Margin="10,5,0,0"
                    Text="{Binding ActiveProjectPath}"
                    TextWrapping="Wrap" />
            </StackPanel>
        </StackPanel>

        <Grid Visibility="{Binding WatcherIsActive}">
            <Grid.RowDefinitions>
                <RowDefinition Height="40" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="50" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="50" />
            </Grid.ColumnDefinitions>

            <Image
                Grid.Column="0"
                Grid.Row="0"
                Height="24"
                Source="Images/eye-tsp-53-32.png"
                Width="53" />

            <Label
                FontSize="14"
                Grid.Column="1"
                Grid.Row="0"
                Margin="10,5,0,0">
                Watching
            </Label>

            <Button
                Background="Red"
                Grid.Column="2"
                Grid.Row="0"
                Height="32"
                Margin="0,0,0,0"
                Width="48">
                <Canvas Height="24" Width="24">
                    <Rectangle
                        Canvas.Left="4"
                        Canvas.Top="4"
                        Fill="White"
                        Height="16"
                        Width="16" />
                </Canvas>
            </Button>

            <TreeView
                BorderThickness="0"
                Grid.Column="0"
                Grid.ColumnSpan="3"
                Grid.Row="1"
                ItemsSource="{Binding Watching}"
                Margin="-10,20,0,0">
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate>
                        <TreeViewItem IsExpanded="{Binding IsExpanded}" Margin="0,0,0,10">
                            <TreeViewItem.Header>
                                <DockPanel>
                                    <Image
                                        DockPanel.Dock="Left"
                                        Height="20"
                                        Source="Images/green-tick.png"
                                        Visibility="{Binding Success}"
                                        Width="20" />
                                    <Image
                                        DockPanel.Dock="Left"
                                        Height="16"
                                        Source="Images/delete-24.png"
                                        Visibility="{Binding Success}"
                                        Width="16" />
                                    <TextBlock
                                        DockPanel.Dock="Left"
                                        FontSize="14"
                                        Margin="10,4,0,5"
                                        Text="{Binding Name}" />
                                </DockPanel>
                            </TreeViewItem.Header>

                            <StackPanel
                                Margin="15,0,0,0"
                                Orientation="Vertical"
                                Visibility="{Binding Result.CalculationDetail}">
                                <TextBlock
                                    FontWeight="Bold"
                                    Margin="0,0,0,5"
                                    Text="Inputs" />
                                <ItemsControl ItemsSource="{Binding Result.CalculationDetail.Inputs}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Margin="10,0,0,5" Orientation="Horizontal">
                                                <!--  <maths:FormulaControl  -->
                                                <!--  Formula="{Binding Symbol}"  -->
                                                <!--  Margin="0,4,10,0"  -->
                                                <!--  Scale="15" />  -->
                                                <TextBlock
                                                    Text="{Binding DisplayName}"
                                                    TextWrapping="Wrap"
                                                    Width="125" />
                                                <TextBlock Text="{Binding Value}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <TextBlock
                                    FontWeight="Bold"
                                    Margin="0,20,0,5"
                                    Text="Outputs" />
                                <ItemsControl ItemsSource="{Binding Result.CalculationDetail.Outputs}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Margin="10,0,0,5" Orientation="Horizontal">
                                                <TextBlock
                                                    Text="{Binding DisplayName}"
                                                    TextWrapping="Wrap"
                                                    Width="125" />
                                                <TextBlock Text="{Binding Value}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <TextBlock
                                    FontWeight="Bold"
                                    Margin="0,20,0,5"
                                    Text="Formulae" />

                                <ItemsControl ItemsSource="{Binding Result.CalculationDetail.Formulae}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Margin="10,0,0,25" Orientation="Vertical">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock
                                                        FontWeight="Bold"
                                                        Text="Ref."
                                                        Width="30" />
                                                    <TextBlock Text="{Binding Ref}" TextWrapping="Wrap" />
                                                </StackPanel>

                                                <TextBlock
                                                    FontWeight="Bold"
                                                    Margin="0,10,0,5"
                                                    Text="Narrative" />
                                                <TextBlock Text="{Binding Narrative}" TextWrapping="Wrap" />

                                                <!--  <ItemsControl  -->
                                                <!--  ItemsSource="{Binding Expression}"  -->
                                                <!--  Margin="0,20,0,0"  -->
                                                <!--  Visibility="{Binding Expression}">  -->
                                                <!--     <ItemsControl.ItemTemplate> -->
                                                <!--         <DataTemplate> -->
                                                <!--             <maths:FormulaControl Formula="{Binding}" Scale="20" /> -->
                                                <!--         </DataTemplate> -->
                                                <!--     </ItemsControl.ItemTemplate> -->
                                                <!-- </ItemsControl> -->
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>

                            <StackPanel Orientation="Vertical" Visibility="{Binding Result.Failure}">
                                <TextBlock Text="{Binding Result.Failure.Message}" />
                            </StackPanel>
                        </TreeViewItem>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>
        </Grid>
    </Grid>
</DataTemplate>
